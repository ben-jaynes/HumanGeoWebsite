<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>Thinking Geographically</title>
        <!-- <link rel="shortcut icon" href="CSS/Images/particle4.png" type="image/x-icon"> -->
        <link href="CSS/index.css" rel="stylesheet" type="text/css" />

        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Playfair:wght@400&display=swap" rel="stylesheet">
    </head>
    <body>
        <div class="transitionIn"></div>

        <div id="mySidenav" class="sidenav">
            <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
            <a class="navLink" onclick="transitionOut('index.html')">Home</a>
            <a class="navLink" onclick="transitionOut('thinkingGeographically.html')">Thinking Geographically</a>
            <a class="navLink" onclick="transitionOut('populationMigration.html')">Population and Migration Map</a>
            <a class="navLink" onclick="transitionOut('culture.html')">Cultural</a>
            <a class="navLink" onclick="transitionOut('political.html')">Political</a>
            <a class="navLink" onclick="transitionOut('agriculture.html')">Ag and Cultural Land Use</a>
            <a class="navLink" onclick="transitionOut('landUse.html')">Cities and Urban Land Use</a>
            <a class="navLink" onclick="transitionOut('economicDevelopment.html')">Industrial and Economic Development</a>
          </div>

        <header id="navBar">
            <span style="font-size:30px; cursor:pointer; font-size: 60px;" onclick="openNav()">&#9776;</span>
            <!-- <div style="display: flex; flex-direction: row; float: right; height: 80px; line-height: 80px;">
                <a href="index.html" class="navLink">Home</a>
                <a href="thinkingGeographically.html" class="navLink">Thinking Geographically</a>
            </div> -->
            <h1 style="float: right; margin-right: 70px;">Ben Jaynes</h1>
        </header>

        <div id="splashDiv">
            <img src="Images/Image 5.jpeg" alt="Combined flag of Greece and Grenada" id="splashImage">
            <img id="splashLogo" src="Images/urbanLandUse2.png" style="width: 60%; left: 10%; top: 250px;">
        </div>

       <div>
        <table  id="countryList">
       </div>


        

        <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
        <script src="https://unpkg.com/validator@latest/validator.min.js"></script>
        <!-- <script src="sorttable.js"></script> -->
        <script>
            

            const Http = new XMLHttpRequest();
            const url='https://api.worldbank.org/v2/country/all/indicator/SE.PRM.CMPT.ZS;SE.XPD.TOTL.GD.ZS;SE.ADT.LITR.ZS?format=json&source=2&mrv=1&per_page=1000';
            Http.open("GET", url);
            Http.send();

            var text = ""
            Http.onreadystatechange = (e) => {
                text = Http.responseText;
                const data = JSON.parse(text);
                
                var newData = [];

                for (var i = 0; i < data[1].length; i++)
                {
                    if(validator.isISO31661Alpha3(data[1][i].countryiso3code) || validator.isISO31661Alpha2(data[1][i].countryiso3code)) {
                        newData.push(data[1][i]);
                    }
                    
                }

                var countries = {};

                for (var i = 0; i < newData.length; i++)
                {
                    countries[newData[i].country.value] = [];
                }
                for (var i = 0; i < newData.length; i++)
                {
                    countries[newData[i].country.value].push(newData[i]);
                }

                
               
                const countryList = document.getElementById("countryList");
                countryList.innerHTML = "<thead><tr><th>Country</th><th>Score</th></tr></thead>";
                const tableBody = document.createElement("tbody");
                

                for (const [key, value] of Object.entries(countries))
                {
                    const row = document.createElement("tr");
                    const country = document.createElement("td");
                    const dataPoint = document.createElement("td");
                    country.innerHTML = value[0].country.value;
                    dataPoint.innerHTML = value[0].value;

                    row.appendChild(country);
                    row.appendChild(dataPoint);

                    tableBody.appendChild(row);
                }


                countryList.appendChild(tableBody);

                console.log("hi");
                
                
            }

            

            

            function openNav() {
              document.getElementById("mySidenav").style.width = "250px";
            }
            
            function closeNav() {
              document.getElementById("mySidenav").style.width = "0";
            }

            async function transitionOut(pageLink) {
                document.getElementsByClassName("transitionIn")[0].className = "transitionOut";
                await new Promise(r => setTimeout(r, 1000));
                document.location.href = pageLink;
            }

            const elements = document.querySelectorAll('.animText');
            const options = {
                root: null,
                rootMargin: '0px',
                threshold: .4
            }
            const callbacks = (entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting){
                entry.target.classList.add('animateIn');
                }
            });
            }
            let observer = new IntersectionObserver(callbacks, options);
            elements.forEach(element => {
            observer.observe(element);
            });
        </script>
    </body>
</html>